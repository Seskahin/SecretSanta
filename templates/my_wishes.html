{% extends "base.html" %}

{% block title %}My Wishes - Family Christmas Wish List{% endblock %}

{% block content %}
    <div style="margin-bottom: 20px;">
        <a href="{{ url_for('select_member') }}" style="padding: 8px 16px; background-color: #c41e3a; color: white; border-radius: 4px; text-decoration: none;">ğŸ… Change Selection</a>
        &nbsp;
        <a href="{{ url_for('index') }}" style="padding: 8px 16px; background-color: #007bff; color: white; border-radius: 4px; text-decoration: none;">â† All Wishes</a>
    </div>

    <h2>My Wish View</h2>

    {% if not assignments %}
    <div style="background-color: #fff3cd; color: #856404; padding: 12px; border-radius: 5px; margin-bottom: 20px;">
        âš ï¸ No Secret Santa assignments have been made yet. Ask the admin to run the draw first!
    </div>
    {% endif %}

    {% if wishes_by_person %}
        {% for person_name, wishes in wishes_by_person.items() %}
        <div style="margin-bottom: 40px;">
            <h3 style="color: #c41e3a; border-bottom: 2px solid #c41e3a; padding-bottom: 10px;">
                ğŸ {{ person_name }}'s Wishes
                {% if person_name in selected_members %}
                    <span style="font-size: 13px; font-weight: normal; background-color: #d4edda; color: #155724; padding: 2px 8px; border-radius: 10px; margin-left: 8px;">You</span>
                {% else %}
                    <span style="font-size: 13px; font-weight: normal; background-color: #cce5ff; color: #004085; padding: 2px 8px; border-radius: 10px; margin-left: 8px;">Your Secret Santa target ğŸ…</span>
                {% endif %}
                <span style="font-size: 14px; font-weight: normal; color: #666;">({{ wishes|length }} wish{% if wishes|length != 1 %}es{% endif %})</span>
            </h3>

            {% if wishes %}
            <table>
                <thead>
                    <tr>
                        <th>Wish</th>
                        <th>Product Link</th>
                        {% if person_name in selected_members %}
                        <th>Actions</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for wish in wishes %}
                    <tr>
                        <td style="white-space: pre-wrap;">{{ wish.wish_text }}</td>
                        <td>
                            {% if wish.product_link %}
                                <a href="{{ wish.product_link }}" target="_blank">View Product</a>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        {% if person_name in selected_members %}
                        <td>
                            <form method="POST" action="{{ url_for('delete_wish', wish_id=wish.id) }}" style="display: inline;">
                                <button type="submit" class="btn-delete" onclick="return confirm('Are you sure you want to delete this wish?');">Delete</button>
                            </form>
                        </td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p style="color: #666; font-style: italic; margin: 20px 0;">No wishes added yet for {{ person_name }}.</p>
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
    <p style="text-align: center; color: #666; margin: 40px 0;">
        No wishes found. ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦
    </p>
    {% endif %}

    <!-- Form to add a new wish for yourself -->
    {% if selected_members %}
    <h2 style="margin-top: 40px;">Add a New Wish</h2>
    <form method="POST" action="{{ url_for('add_wish') }}">
        <label for="person_name">For:</label>
        <select id="person_name" name="person_name" required style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;">
            {% for member in selected_members %}
                <option value="{{ member }}">{{ member }}</option>
            {% endfor %}
        </select>

        <label for="wish_text">Wish Text (required):</label>
        <textarea id="wish_text" name="wish_text" rows="3" required></textarea>

        <label for="product_link">Product Link (optional):</label>
        <input type="text" id="product_link" name="product_link" placeholder="https://...">

        <button type="submit" class="btn-primary">Add Wish</button>
    </form>
    {% endif %}
{% endblock %}
