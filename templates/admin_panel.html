{% extends "base.html" %}

{% block title %}Admin - Family Members{% endblock %}

{% block content %}
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>Admin - Manage Family Members</h2>
        <a href="{{ url_for('admin_logout') }}" style="padding: 8px 16px; background-color: #6c757d; color: white; border-radius: 4px; text-decoration: none;">Logout</a>
    </div>
    
    <div style="margin-bottom: 20px;">
        <a href="{{ url_for('my_wishlist') }}" style="padding: 8px 16px; background-color: #007bff; color: white; border-radius: 4px; text-decoration: none;">â† Back to My Wishlist</a>
    </div>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div style="padding: 10px; margin-bottom: 15px; border-radius: 5px; {% if category == 'success' %}background-color: #d4edda; color: #155724;{% else %}background-color: #f8d7da; color: #721c24;{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <!-- Form to add a new family member -->
    <h3>Add Family Member</h3>
    <form method="POST" action="{{ url_for('add_family_member') }}">
        <label for="name">Family Member Name:</label>
        <input type="text" id="name" name="name" required>

        <label for="team_name">Team (optional, e.g. "Team A"):</label>
        <input type="text" id="team_name" name="team_name" placeholder="Leave blank if no team">
        
        <button type="submit" class="btn-primary">Add Member</button>
    </form>

    <!-- Table displaying all family members -->
    <h3>Family Members Pool</h3>
    {% if family_members %}
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Team</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for member in family_members %}
            {# Define the edit form outside the table cells so inputs can reference it via the form attribute #}
            <form id="edit-member-{{ member.id }}" method="POST" action="{{ url_for('edit_family_member', member_id=member.id) }}"></form>
            <tr>
                <td>
                    <input form="edit-member-{{ member.id }}" type="text" name="name" value="{{ member.name }}" style="width: 180px;">
                </td>
                <td>
                    <input form="edit-member-{{ member.id }}" type="text" name="team_name" value="{{ member.team_name or '' }}" placeholder="No team" style="width: 150px;">
                </td>
                <td>
                    <button form="edit-member-{{ member.id }}" type="submit" class="btn-primary" style="font-size: 12px; padding: 5px 10px;">Update</button>
                    <form method="POST" action="{{ url_for('delete_family_member', member_id=member.id) }}" style="display: inline;">
                        <button type="submit" class="btn-delete" onclick="return confirm('Are you sure? This will also delete all wishes for {{ member.name }}.');">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; color: #666; margin: 40px 0;">
        No family members yet. Add the first one above! ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦
    </p>
    {% endif %}

    <!-- Secret Santa section -->
    <h3 style="margin-top: 40px;">ğŸ… Secret Santa Assignments</h3>
    <form method="POST" action="{{ url_for('run_secret_santa') }}" style="margin-bottom: 20px;">
        <button type="submit" class="btn-primary" onclick="return confirm('This will overwrite existing Secret Santa assignments. Continue?');">Run Secret Santa</button>
    </form>
    {% if secret_santa %}
    <table>
        <thead>
            <tr>
                <th>Giver</th>
                <th>â†’ Buys for</th>
            </tr>
        </thead>
        <tbody>
            {% for assignment in secret_santa %}
            <tr>
                <td>{{ assignment.giver_name }}</td>
                <td>{{ assignment.receiver_name }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #666; font-style: italic;">No Secret Santa assignments yet. Click "Run Secret Santa" to generate them.</p>
    {% endif %}

    <!-- All wishes table -->
    <h3 style="margin-top: 40px;">ğŸ“‹ All Wishes</h3>
    {% if all_wishes %}
    <table>
        <thead>
            <tr>
                <th>Person</th>
                <th>Wish</th>
                <th>Product Link</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for wish in all_wishes %}
            <tr>
                <td>{{ wish.person_name }}</td>
                <td>{{ wish.wish_text | nl2br }}</td>
                <td>
                    {% if wish.product_link %}
                        <a href="{{ wish.product_link }}" target="_blank">View Product</a>
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    <form method="POST" action="{{ url_for('delete_wish', wish_id=wish.id) }}" style="display: inline;">
                        <button type="submit" class="btn-delete" onclick="return confirm('Are you sure you want to delete this wish?');">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #666; font-style: italic;">No wishes added yet.</p>
    {% endif %}
{% endblock %}
